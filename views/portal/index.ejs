
		<%- include('partial/header', { title: 'Wishmewell Apartment',email:email,roleName:roleName }) %>
		<%- include('partial/sidebar', { name: name}) %>

<style>
	.modern-dashboard {
		background: #f8f9fa;
		min-height: 100vh;
	}

	.dashboard-header {
		background: linear-gradient(135deg, #1c2830 0%, #2a3a45 100%);
		color: white;
		padding: 30px;
		border-radius: 15px;
		margin-bottom: 30px;
		box-shadow: 0 4px 15px rgba(193, 155, 118, 0.3);
	}

	.dashboard-header h2 {
		margin: 0;
		font-weight: 700;
		font-size: 2rem;
	}

	.dashboard-header p {
		margin: 5px 0 0 0;
		opacity: 0.9;
		font-size: 1rem;
	}

	.stat-card {
		background: white;
		border-radius: 12px;
		padding: 25px;
		margin-bottom: 25px;
		box-shadow: 0 2px 10px rgba(0,0,0,0.08);
		transition: all 0.3s ease;
		border: none;
		position: relative;
		overflow: hidden;
	}

	.stat-card::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		width: 4px;
		height: 100%;
		background: linear-gradient(180deg, #6b6b6b 0%, #4a4a4a 100%);
	}

	.stat-card:hover {
		transform: translateY(-5px);
		box-shadow: 0 5px 20px rgba(0,0,0,0.15);
	}

	.stat-card .icon-wrapper {
		width: 60px;
		height: 60px;
		border-radius: 12px;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 24px;
		margin-bottom: 15px;
	}

	.stat-card.primary .icon-wrapper {
		background: linear-gradient(135deg, #6b6b6b 0%, #4a4a4a 100%);
		color: white;
	}

	.stat-card.success .icon-wrapper {
		background: linear-gradient(135deg, #7a7a7a 0%, #5a5a5a 100%);
		color: white;
	}

	.stat-card.info .icon-wrapper {
		background: linear-gradient(135deg, #9e9e9e 0%, #7a7a7a 100%);
		color: white;
	}

	.stat-card.warning .icon-wrapper {
		background: linear-gradient(135deg, #8a8a8a 0%, #6a6a6a 100%);
		color: white;
	}

	.stat-card.danger .icon-wrapper {
		background: linear-gradient(135deg, #5a5a5a 0%, #3a3a3a 100%);
		color: white;
	}

	.stat-card h3 {
		font-size: 2rem;
		font-weight: 700;
		margin: 10px 0;
		color: #2c3e50;
	}

	.stat-card p {
		color: #6c757d;
		margin: 0;
		font-size: 0.95rem;
		font-weight: 500;
	}

	.stat-card .trend {
		font-size: 0.85rem;
		margin-top: 8px;
	}

	.stat-card .trend.up {
		color: #28a745;
	}

	.stat-card .trend.down {
		color: #dc3545;
	}

	.chart-card {
		background: white;
		border-radius: 12px;
		padding: 25px;
		margin-bottom: 25px;
		box-shadow: 0 2px 10px rgba(0,0,0,0.08);
		border: none;
	}

	.chart-card .card-header {
		background: transparent;
		border: none;
		padding: 0 0 20px 0;
	}

	.chart-card .card-title {
		font-size: 1.3rem;
		font-weight: 600;
		color: #2c3e50;
		margin: 0;
	}

	.section-title {
		font-size: 1.5rem;
		font-weight: 600;
		color: #2c3e50;
		margin: 30px 0 20px 0;
		padding-left: 15px;
		border-left: 4px solid #1c2830;
	}
</style>

		<div class="page-wrapper modern-dashboard">
			<div class="content container-fluid">
				<div class="dashboard-header">
					<h2><i class="fas fa-chart-line"></i> Welcome back, <%= name %>!</h2>
					<p><i class="far fa-calendar-alt"></i> <%= new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></p>
				</div>
				<!-- Quick Stats Section -->
				<h5 class="section-title"><i class="fas fa-tachometer-alt"></i> Quick Stats</h5>
				<div class="row">
					<% if (roleName === 'ceo' || roleName === "hotelmanager" || roleName === "hotel receptionist") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card primary">
							<div class="icon-wrapper">
								<i class="fas fa-money-check-alt"></i>
							</div>
							<h3><%= (data.todayBooking / 100 || 0).toLocaleString('en-NG', { style: 'currency', currency: 'NGN', minimumFractionDigits: 0, maximumFractionDigits: 0 }) %></h3>
							<p>Today's Booking Amount</p>
						</div>
					</div>
					<% } %>

					<% if (roleName === 'ceo' || roleName === "hotelmanager" || roleName === "hotel receptionist") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card success">
							<div class="icon-wrapper">
								<i class="fas fa-globe"></i>
							</div>
							<h3><%= (data.totalAmountForWebOnline.totalAmount / 100 || 0).toLocaleString('en-NG',{ style: 'currency', currency: 'NGN', minimumFractionDigits: 0, maximumFractionDigits: 0 }) %></h3>
							<p>Online Booking Amount</p>
						</div>
					</div>
					<% } %>
					<% if (roleName === 'ceo' || roleName === "hotelmanager" || roleName === "hotel receptionist") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card info">
							<div class="icon-wrapper">
								<i class="fas fa-chart-bar"></i>
							</div>
							<h3><%=data.totalAmountForWebOnline.bookingCount %></h3>
							<p>Online Booking Count</p>
						</div>
					</div>
					<% } %>
					<% if (roleName === 'ceo' || roleName === "hotelmanager" || roleName === "hotel receptionist") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card warning">
							<div class="icon-wrapper">
								<i class="fas fa-cash-register"></i>
							</div>
							<h3><%= (data.totalAmountForReception.totalAmount / 100 || 0).toLocaleString('en-NG', { style: 'currency', currency: 'NGN', minimumFractionDigits: 0, maximumFractionDigits: 0 }) %></h3>
							<p>Reception Booking Amount</p>
						</div>
					</div>
					<% } %>

					<% if (roleName === 'ceo' || roleName === "hotelmanager" || roleName === "hotel receptionist") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card primary">
							<div class="icon-wrapper">
								<i class="fas fa-clipboard-list"></i>
							</div>
							<h3><%=data.totalAmountForReception.bookingCount %></h3>
							<p>Reception Booking Count</p>
						</div>
					</div>
					<% } %>

					<% if (roleName === 'ceo' || roleName === "hotelmanager" || roleName === "hotel receptionist") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card success">
							<div class="icon-wrapper">
								<i class="fas fa-door-open"></i>
							</div>
							<h3><%= data.availableroomCount %></h3>
							<p>Available Rooms</p>
						</div>
					</div>
					<% } %>

					<% if (roleName === 'ceo' || roleName === "hotelmanager" || roleName === "hotel receptionist") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card info">
							<div class="icon-wrapper">
								<i class="fas fa-door-closed"></i>
							</div>
							<h3><%= data.roomCount %></h3>
							<p>Total Room Count</p>
						</div>
					</div>
					<% } %>

					<% if (roleName === 'ceo' || roleName === "hotelmanager") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card warning">
							<div class="icon-wrapper">
								<i class="fas fa-users"></i>
							</div>
							<h3><%= data.totalStaff %></h3>
							<p>Total Staff</p>
						</div>
					</div>
					<% } %>

					<% if (roleName === 'ceo' || roleName === "hotelmanager") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card primary">
							<div class="icon-wrapper">
								<i class="fas fa-user-friends"></i>
							</div>
							<h3><%= data.customerCount %></h3>
							<p>Total Customers</p>
						</div>
					</div>
					<% } %>

					<% if (roleName === 'ceo' || roleName === "hotelmanager" || roleName === "bar manager") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card danger">
							<div class="icon-wrapper">
								<i class="fas fa-wine-bottle"></i>
							</div>
							<h3>₦<%= (data.todayBarSummary || 0).toLocaleString('en-NG', { minimumFractionDigits: 0, maximumFractionDigits: 0 }) %></h3>
							<p>Bar Amount Today</p>
						</div>
					</div>
					<% } %>

					<% if (roleName === 'ceo' || roleName === "hotelmanager" || roleName === "bar manager") { %>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card success">
							<div class="icon-wrapper">
								<i class="fas fa-cocktail"></i>
							</div>
							<h3><%= data.totalDrink %></h3>
							<p>Total Drinks Count</p>
						</div>
					</div>
					<% } %>
				</div>

				<!-- Finance Section -->
				<% if (roleName === 'ceo' || roleName === "hotelmanager") { %>
				<h5 class="section-title"><i class="fas fa-chart-line"></i> Finance Overview</h5>
				<div class="row">
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card danger">
							<div class="icon-wrapper">
								<i class="fas fa-receipt"></i>
							</div>
							<h3>₦<%= ((data.todayExpenses || 0) / 100).toLocaleString('en-NG', { minimumFractionDigits: 0, maximumFractionDigits: 0 }) %></h3>
							<p>Today's Expenses</p>
						</div>
					</div>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card danger">
							<div class="icon-wrapper">
								<i class="fas fa-calendar-alt"></i>
							</div>
							<h3>₦<%= ((data.monthExpenses || 0) / 100).toLocaleString('en-NG', { minimumFractionDigits: 0, maximumFractionDigits: 0 }) %></h3>
							<p>This Month's Expenses</p>
						</div>
					</div>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card warning">
							<div class="icon-wrapper">
								<i class="fas fa-tools"></i>
							</div>
							<h3>₦<%= ((data.monthDamages || 0) / 100).toLocaleString('en-NG', { minimumFractionDigits: 0, maximumFractionDigits: 0 }) %></h3>
							<p>Damages This Month</p>
						</div>
					</div>
					<div class="col-xl-3 col-sm-6 col-12">
						<div class="stat-card warning">
							<div class="icon-wrapper">
								<i class="fas fa-exclamation-triangle"></i>
							</div>
							<h3><%= data.pendingDamages || 0 %></h3>
							<p>Pending Repairs</p>
						</div>
					</div>
				</div>
				<% } %>

				<!-- Charts Section -->
				<% if (roleName === 'ceo' || roleName === "hotelmanager") { %>
				<h5 class="section-title"><i class="fas fa-chart-area"></i> Analytics & Reports</h5>
				<div class="row">
					<div class="col-md-12 col-lg-6">
						<div class="chart-card">
							<div class="card-header">
								<h4 class="card-title"><i class="fas fa-calendar-day"></i> Booking Total Amount Per Day</h4>
							</div>
							<div class="card-body">
								<div id="chart-1"></div>
							</div>
						</div>
					</div>
					<div class="col-md-12 col-lg-6">
						<div class="chart-card">
							<div class="card-header">
								<h4 class="card-title"><i class="fas fa-calendar-alt"></i> Booking Count Per Month</h4>
							</div>
							<div class="card-body">
								<div id="chart"></div>
							</div>
						</div>
					</div>
					<div class="col-md-12 col-lg-12">
						<div class="chart-card">
							<div class="card-header">
								<h4 class="card-title"><i class="fas fa-money-bill-wave"></i> Booking Total Amount Per Month</h4>
							</div>
							<div class="card-body">
								<div id="chart2"></div>
							</div>
						</div>
					</div>
				</div>
				<% } %>
					<% if (roleName === 'ceo' || roleName === "hotelmanager") { %>
					<div class="row">
						<div class="col-md-12 d-flex">
							<div class="card card-table flex-fill">
								<div class="card-header">
									<h4 class="card-title float-left mt-2">Booking</h4>
									<a type="button" href="/portal/all-booking" class="btn btn-primary float-right veiwbutton">Veiw All</a>
								</div>
								
							</div>
						</div>
						<% } %>
					</div>
			</div>
		</div>
	</div>
	<script data-cfasync="false" src="../../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
	<script src="assets/js/jquery-3.5.1.min.js"></script>
	<script src="assets/js/popper.min.js"></script>
	<script src="assets/js/bootstrap.min.js"></script>
	<script src="assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script src="assets/plugins/raphael/raphael.min.js"></script>
	<script src="assets/plugins/morris/morris.min.js"></script>
	<script src="assets/js/chart.morris.js"></script>
	<script src="assets/js/script.js"></script>
	<script>

async function fetchMonthlyData() {
            try {
                const response = await fetch('/portal/dashboard/monthly-bookings');
                const data = await response.json();
                console.log("🚀 ~ fetchMonthlyData ~ data:", data.monthlyData)

				const categories = data.monthlyData.map(item => new Date(item.month).toLocaleString('default', { month: 'long', year: 'numeric' }));
    const seriesData = data.monthlyData.map(item => parseFloat(item.count));

    // Render chart with custom color and radius
    const option = {
        chart: {
            type: 'bar'
        },
        series: [{
            name: 'Bookings',
            data: seriesData
        }],
        xaxis: {
            categories: categories
        },
        title: {
            text: 'Monthly Bookings'
        },
        colors: ['#1c2830'],  // Set bar color to #1c2830
        plotOptions: {
            bar: {
                borderRadius: 10,  // Set bar border radius (adjust the value as needed)
                distributed: true  // To ensure individual bars take the same color
            }
        }
    };

    const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

    // Log the data for debugging
    console.log("🚀 ~ data.weeklyData:", data.weeklyData);

    // Check if `weeklyData` exists and has valid data
    if (data.weeklyData && data.weeklyData.length > 0) {
        // Map the data for each week to show the week start date
        const categories = data.weeklyData.map(item => {
            const weekStartDate = new Date(item.week);  // Convert `week` field to Date object
            if (isNaN(weekStartDate)) {
                console.error("Invalid date:", item.week);
                return 'Invalid date';  // Handle invalid dates
            }
            // Format the week start date as 'dd MMM yyyy' (e.g., '05 Feb 2024')
            return weekStartDate.toLocaleDateString('default', { day: 'numeric', month: 'short', year: 'numeric' });
        });
        
        const seriesData = data.weeklyData.map(item => parseFloat(item.totalAmount / 100));  // Use count of bookings per week

        // Log categories and seriesData to debug
        console.log("🚀 ~ Categories (Week Start Dates):", categories);
        console.log("🚀 ~ Series Data (Booking Counts):", seriesData);

        // Render the chart with a line chart
        const options = {
            chart: {
                type: 'line',  // Change to 'line' chart
                height: 350
            },
            series: [{
                name: 'Bookings',
                data: seriesData  // Use the series data from `weeklyData`
            }],
            xaxis: {
                categories: categories  // Display the start date of the week
            },
            title: {
                text: 'Bookings Per Week'
            },
            stroke: {
                curve: 'smooth',  // Create smooth curves for the line
                width: 2  // Set line width
            },
            colors: ['#1c2830'],  // Set line color to #1c2830
            markers: {
                size: 4,  // Set marker size on the line chart
                colors: ['#1c2830']  // Set marker color
            },
            tooltip: {
                enabled: true,
                x: {
                    format: 'dd MMM yyyy'  // Date format for tooltip
                }
            }
        };

        // Initialize and render the chart
        const chart = new ApexCharts(document.querySelector("#chart-1"), options);
        chart.render();
    } else {
        console.error("No data available for weekly bookings");
    }


	const categoriess = data.monthlyData.map(item => new Date(item.month).toLocaleString('default', { month: 'long', year: 'numeric' }));
    const seriesDatas = data.monthlyData.map(item => ({
        x: new Date(item.month).toLocaleString('default', { month: 'long', year: 'numeric' }),
        y: parseFloat(item.totalAmount / 100)
    }));

    // Define options for the chart
    var options = {
        series: [{
            data: seriesDatas  // Use totalAmount data for each month
        }],
        legend: {
            show: false
        },
        chart: {
            height: 350,
            type: 'treemap'
        },
        title: {
            text: 'Monthly Total Amount Treemap',
            align: 'center'
        },
        colors: [
            '#3B93A5', '#F7B844', '#ADD8C7', '#EC3C65',
            '#CDD7B6', '#C1F666', '#D43F97', '#1E5D8C',
            '#421243', '#7F94B0', '#EF6537', '#C0ADDB'
        ],
        plotOptions: {
            treemap: {
                distributed: true,
                enableShades: false
            }
        }
    };


    const chart = new ApexCharts(document.querySelector("#chart"), option);
    chart.render();

    const charts = new ApexCharts(document.querySelector("#chart2"), options);
	charts.render();
            } catch (error) {
                console.error('Error fetching chart data:', error);
            }
        }

        // Load the chart
        fetchMonthlyData();
	</script>
</body>

</html>