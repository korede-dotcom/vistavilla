<%- include('partial/header', { title: 'Room Transfer History - Wishmewell Apartment',email:email,roleName:roleName }) %>
<%- include('partial/sidebar', { name: name}) %>

<div class="page-wrapper">
	<div class="content container-fluid">
		<div class="page-header">
			<div class="row align-items-center">
				<div class="col">
					<div class="mt-5">
						<h4 class="card-title float-left mt-2">
							<i class="fas fa-exchange-alt"></i> Room Transfer History
						</h4>
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-sm-12">
				<div class="card card-table">
					<div class="card-body booking_card">
						<div class="table-responsive">
							<table class="datatable table table-stripped table table-hover table-center mb-0">
								<thead>
									<tr>
										<th>S/N</th>
										<th>Date & Time</th>
										<th>Booking Ref</th>
										<th>Guest Name</th>
										<th>From Room</th>
										<th>To Room</th>
										<th>Transferred By</th>
										<th>Booking Period</th>
										<th>Reason</th>
									</tr>
								</thead>
								<tbody>
									<% if (transfers && transfers.length > 0) { %>
										<% transfers.forEach((transfer, index) => { %>
											<tr>
												<td><%= index + 1 %></td>
												<td>
													<%= new Date(transfer.createdAt).toLocaleString('en-GB', {
														year: 'numeric',
														month: 'short',
														day: 'numeric',
														hour: '2-digit',
														minute: '2-digit'
													}) %>
												</td>
												<td>
													<a href="/portal/check-in?key=<%= transfer.booking_reference %>" style="color: #6b6b6b; font-weight: 600;">
														<%= transfer.booking_reference %>
													</a>
												</td>
												<td><%= transfer.guest_name %></td>
												<td>
													<div>
														<strong style="color: #dc3545;"><%= transfer.old_room_number %></strong>
														<br>
														<small class="text-muted"><%= transfer.old_room_name || 'N/A' %></small>
														<br>
														<small class="badge badge-secondary"><%= transfer.old_category_name || 'N/A' %></small>
													</div>
												</td>
												<td>
													<div>
														<strong style="color: #28a745;"><%= transfer.new_room_number %></strong>
														<br>
														<small class="text-muted"><%= transfer.new_room_name || 'N/A' %></small>
														<br>
														<small class="badge badge-secondary"><%= transfer.new_category_name || 'N/A' %></small>
													</div>
												</td>
												<td>
													<span class="badge badge-info">
														<i class="fas fa-user"></i> <%= transfer.transferred_by %>
													</span>
												</td>
												<td>
													<% if (transfer.booking_start && transfer.booking_end) { %>
														<small>
															<%= new Date(transfer.booking_start).toLocaleDateString('en-GB') %>
															<br>to<br>
															<%= new Date(transfer.booking_end).toLocaleDateString('en-GB') %>
														</small>
													<% } else { %>
														<em class="text-muted">N/A</em>
													<% } %>
												</td>
												<td>
													<% if (transfer.transfer_reason) { %>
														<%= transfer.transfer_reason %>
													<% } else { %>
														<em class="text-muted">No reason provided</em>
													<% } %>
												</td>
											</tr>
										<% }); %>
									<% } else { %>
										<tr>
											<td colspan="9" class="text-center text-muted">
												<i class="fas fa-info-circle"></i> No room transfers found
											</td>
										</tr>
									<% } %>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="assets/js/jquery-3.5.1.min.js"></script>
<script src="assets/js/popper.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/moment.min.js"></script>
<script src="assets/js/select2.min.js"></script>
<script src="assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="assets/js/bootstrap-datetimepicker.min.js"></script>
<script src="assets/plugins/datatables/datatables.min.js"></script>
<script src="assets/js/script.js"></script>

<script>
	$(document).ready(function() {
		// Check if DataTable is already initialized
		if (!$.fn.DataTable.isDataTable('.datatable')) {
			$('.datatable').DataTable({
				order: [[1, 'desc']], // Sort by date descending
				pageLength: 25,
				language: {
					emptyTable: "No room transfers found"
				}
			});
		}
	});
</script>

</body>
</html>

